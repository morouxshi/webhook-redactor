/*! webhook-redactor - v0.0.1 - 2013-09-12
* https://github.com/gpbmike/webhook-redactor
* Copyright (c) 2013 Mike Horn; Licensed MIT */
(function(t){"use strict";window.RedactorPlugins=window.RedactorPlugins||{},t.embedly.defaults.key="65874c90af644c6a8f0b7072fe857811",t.embedly.defaults.query={maxwidth:640};var e=function(t){this.redactor=t,this.observe()};e.prototype={observe:function(){this.redactor.$editor.on("keyup.redactor",t.proxy(function(t){t.which===this.redactor.keyCode.ENTER&&this.checkNode(this.redactor.$editor.get(0))},this))},checkNode:function(e){return t.each(e.childNodes,t.proxy(function(e,o){if(3===o.nodeType&&o.nodeValue&&o.nodeValue.match(/((http:\/\/(.*youtube\.com\/watch.*|.*\.youtube\.com\/v\/.*|youtu\.be\/.*|.*\.youtube\.com\/user\/.*|.*\.youtube\.com\/.*#.*\/.*|m\.youtube\.com\/watch.*|m\.youtube\.com\/index.*|.*\.youtube\.com\/profile.*|.*\.youtube\.com\/view_play_list.*|.*\.youtube\.com\/playlist.*|www\.vimeo\.com\/groups\/.*\/videos\/.*|www\.vimeo\.com\/.*|vimeo\.com\/groups\/.*\/videos\/.*|vimeo\.com\/.*|vimeo\.com\/m\/#\/.*|player\.vimeo\.com\/.*))|(https:\/\/(.*youtube\.com\/watch.*|.*\.youtube\.com\/v\/.*|www\.vimeo\.com\/.*|vimeo\.com\/.*|player\.vimeo\.com\/.*)))/i)){var i=o.nodeValue,r=t("<span>loading...</span>");t(o).replaceWith(r),t.embedly.oembed(i).done(function(e){t.each(e,function(){r.replaceWith('<figure data-type="video"><p>'+this.html+"</p><figcaption>Type to add caption (optional)</figcaption></figure>")})})}else 1!==o.nodeType||/^(a|button|textarea)$/i.test(o.tagName)||this.checkNode(o)},this)),this.matches}},window.RedactorPlugins.autoembedly={init:function(){this.autoembedly=new e(this)}}})(jQuery),function(t){"use strict";var e=function(t){this.redactor=t,this.init()};e.prototype={init:function(){this.removeEmptyPs()},removeEmptyPs:function(){this.redactor.$editor.find("p").filter(function(){return!t.trim(t(this).text())}).remove()}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.cleanup={init:function(){this.cleanup=new e(this)}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t,this.toolbar={},this.init()};e.prototype={control:{up:{classSuffix:"arrow-up"},down:{classSuffix:"arrow-down"},"|":{classSuffix:"divider"},remove:{classSuffix:"delete"}},controlGroup:["up","down","remove"],init:function(){this.observeCaptions(),this.observeToolbars()},observeCaptions:function(){this.redactor.$editor.on("click","figcaption:empty, cite:empty",t.proxy(function(e){t(e.target).prepend("<br>"),this.redactor.selectionEnd(e.target),e.stopPropagation()},this)),t(window).one("click",t.proxy(this.cleanCaptions,this)),this.redactor.$editor.on("blur",t.proxy(this.cleanCaptions,this)),this.redactor.$editor.closest("form").one("submit",t.proxy(this.clearCaptions,this)),this.redactor.$editor.on("keydown",t.proxy(function(e){var o=this.redactor.getCurrent(),i=!o.length,r=!!t(o).closest("figcaption, cite").length,s=t.inArray(e.keyCode,[this.redactor.keyCode.BACKSPACE,this.redactor.keyCode.DELETE])>=0;i&&s&&r&&e.preventDefault()},this))},cleanCaptions:function(){this.redactor.$editor.find("figcaption, cite").filter(function(){return!t(this).text()}).empty()},clearCaptions:function(){this.redactor.$editor.find("figcaption, cite").filter(function(){return!t(this).text()}).remove()},observeToolbars:function(){this.redactor.$editor.on("mouseenter","figure",t.proxy(function(e){var o=t(e.currentTarget),i=o.data("type")||"default",r=this.getToolbar(i).data("figure",o).prependTo(o);this.redactor[i]&&this.redactor[i].onShow&&this.redactor[i].onShow(o,r)},this)),this.redactor.$editor.on("mouseleave","figure",t.proxy(function(e){t(e.currentTarget).find(".wh-figure-controls").appendTo(this.redactor.$box)},this)),this.redactor.$editor.on("mousedown",".wh-figure-controls",t.proxy(function(){this.current=this.redactor.getCurrent()},this)),this.redactor.$editor.on("click",".wh-figure-controls span, .wh-figure-controls a",t.proxy(function(e){e.stopPropagation();var o=t(e.currentTarget),i=o.data("command"),r=o.closest("figure"),s=this.redactor[r.data("type")];this.command(i,r,s)},this))},getToolbar:function(e){if(this.toolbar[e])return this.toolbar[e];var o=this.redactor[e]&&this.redactor[e].controlGroup||this.controlGroup,i=t.extend({},this.control,this.redactor[e]&&this.redactor[e].control||{}),r=this.buildControls(o,i),s=t('<div class="wh-figure-controls">').append(r);return this.toolbar[e]=s},buildControls:function(e,o){var i=t();return t.each(e,t.proxy(function(e,r){var s;"string"==typeof r?(s=o[r],i=i.add(t("<span>",{"class":"wh-figure-controls-"+s.classSuffix,text:s.text}).data({command:r,control:s}))):"object"==typeof r&&t.each(r,t.proxy(function(e,r){var a=t("<span>",{"class":"wh-figure-controls-table wh-dropdown",text:" "+e});t('<span class="caret">').appendTo(a);var n=t('<dl class="wh-dropdown-menu wh-dropdown-bubble wh-dropdown-arrow wh-dropdown-arrow-left">').appendTo(a);t.each(r,t.proxy(function(e,i){s=o[i],"|"===i?t('<dd class="divider">').appendTo(n):t("<a>",{text:s.text}).data({command:i,control:s}).appendTo(t("<dd>").appendTo(n))},this)),i=i.add(a)},this))},this)),i},command:function(e,o,i){switch(o.find(".wh-figure-controls").appendTo(this.redactor.$box),this.redactor.bufferSet(this.redactor.$editor.html()),e){case"up":o.prev().before(o);break;case"down":o.next().after(o);break;case"remove":o.remove();break;default:i&&i.command&&i.command(e,o,t(this.current))}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.figure={init:function(){this.figure=new e(this)}}}(jQuery),function(t){"use strict";var e=function(e){this.redactor=e,this.$window=t(e.window),this.$window.on("scroll",t.proxy(this.checkOffset,this))};e.prototype={checkOffset:function(){0>=this.redactor.$box.offset().top-this.$window.scrollTop()?this.fix():this.unfix()},fix:function(){var t=parseInt(this.redactor.$box.css("border-left-width").replace("px",""),10);this.redactor.$toolbar.css({position:"fixed",left:this.redactor.$box.offset().left+t,width:this.redactor.$box.width(),zIndex:1}),this.redactor.$editor.css("padding-top",this.redactor.$toolbar.height()+10)},unfix:function(){this.redactor.$toolbar.css({position:"relative",left:"auto",width:"auto"}),this.redactor.$editor.css("padding-top",10)}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.fixedtoolbar={init:function(){this.fixedtoolbar=new e(this)}}}(jQuery),function(t){"use strict";window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.fullscreen={init:function(){this.fullscreen=!1,this.buttonAdd("fullscreen","Fullscreen",t.proxy(this.toggleFullscreen,this)),this.buttonSetRight("fullscreen"),this.opts.fullscreen&&this.toggleFullscreen()},toggleFullscreen:function(){var e;if(this.fullscreen){this.buttonRemoveIcon("fullscreen","normalscreen"),this.buttonInactive("fullscreen"),this.fullscreen=!1,t(window).off("resize",t.proxy(this.fullScreenResize,this)),t("body, html").css("overflow",""),this.$box.removeClass("redactor_box_fullscreen").css({width:"auto",height:"auto"}),this.opts.iframe&&(e=this.$editor.html()),this.tmpspan.after(this.$box).remove(),this.opts.iframe?this.fullscreenIframe(e):this.sync();var o=this.fsheight;this.opts.autoresize&&(o="auto"),this.opts.toolbarExternal&&(this.$box.css("top",this.boxcss.top),this.$toolbar.css({width:this.toolcss.width,top:this.toolcss.top,position:this.toolcss.position})),this.focus(),this.observeStart()}else this.buttonChangeIcon("fullscreen","normalscreen"),this.buttonActive("fullscreen"),this.fullscreen=!0,this.opts.toolbarExternal&&(this.toolcss={},this.boxcss={},this.toolcss.width=this.$toolbar.css("width"),this.toolcss.top=this.$toolbar.css("top"),this.toolcss.position=this.$toolbar.css("position"),this.boxcss.top=this.$box.css("top")),this.fsheight=this.$editor.height(),this.opts.iframe&&(e=this.get()),this.tmpspan=t("<span></span>"),this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan),t("body, html").css("overflow","hidden"),t("body").prepend(this.$box),this.opts.iframe&&this.fullscreenIframe(e),this.fullScreenResize(),t(window).resize(t.proxy(this.fullScreenResize,this)),t(document).scrollTop(0,0),this.focus(),this.observeStart()},fullscreenIframe:function(t){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(t):this.set(t),this.opts.wym&&this.$editor.addClass("redactor_editor_wym")},fullScreenResize:function(){if(!this.fullscreen)return!1;var e=this.$toolbar.height(),o=t(window).height()-e;this.$box.width(t(window).width()-2).height(o+e),this.opts.toolbarExternal&&(this.$toolbar.css({top:"0px",position:"absolute",width:"100%"}),this.$box.css("top",e+"px"))}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t,this.init()};e.prototype={control:{left:{classSuffix:"arrow-left"},right:{classSuffix:"arrow-right"},small:{classSuffix:"small",text:"S"},medium:{classSuffix:"medium",text:"M"},resize_full:{classSuffix:"resize-full"},resize_small:{classSuffix:"resize-small"}},controlGroup:["left","up","down","right","|","small","medium","resize_full","resize_small","remove"],init:function(){this.redactor.$editor.on("focus",t.proxy(this.addCaptions,this)),this.addCaptions()},addCaptions:function(){this.redactor.$editor.find("figure[data-type=image]:not(:has(figcaption))").each(function(){t(this).append("<figcaption>")})},onShow:function(t,e){e.children().removeClass("on"),t.hasClass("wh-figure-small")?(e.find(".wh-figure-controls-small").show().addClass("on"),e.find(".wh-figure-controls-medium").show(),e.find(".wh-figure-controls-resize-full").show(),e.find(".wh-figure-controls-resize-small").hide()):t.hasClass("wh-figure-medium")?(e.find(".wh-figure-controls-small").show(),e.find(".wh-figure-controls-medium").show().addClass("on"),e.find(".wh-figure-controls-resize-full").show(),e.find(".wh-figure-controls-resize-small").hide()):(e.find(".wh-figure-controls-small").hide(),e.find(".wh-figure-controls-medium").hide(),e.find(".wh-figure-controls-large").hide(),e.find(".wh-figure-controls-resize-full").hide(),e.find(".wh-figure-controls-resize-small").show()),t.hasClass("wh-figure-right")&&e.find(".wh-figure-controls-arrow-right").addClass("on"),t.hasClass("wh-figure-left")&&e.find(".wh-figure-controls-arrow-left").addClass("on")},command:function(e,o){var i=function(e,o,i,r){t.isArray(e)||(e=[e]);var s=(r?".":"")+"wh-figure-"+(i||"");return s+e.join((o||" ")+s)},r=function(t,e){o.removeClass(i(t)).addClass(i(e))};switch(e){case"left":case"right":r(["left","right"],e),o.hasClass("wh-figure-medium")||o.hasClass("wh-figure-small")||o.addClass("wh-figure-medium");break;case"small":case"medium":r(["small","medium","large"],e),o.hasClass("wh-figure-left")||o.hasClass("wh-figure-right")||o.addClass("wh-figure-left");break;case"resize_full":r(["small","medium","left","right"],"large");break;case"resize_small":r(["small","large","right"],["medium","left"])}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.image={init:function(){this.image=new e(this)}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t,this.init()};e.prototype={control:{left:{classSuffix:"arrow-left"},right:{classSuffix:"arrow-right"},small:{classSuffix:"small",text:"S"},medium:{classSuffix:"medium",text:"M"},large:{classSuffix:"large",text:"L"},resize_full:{classSuffix:"resize-full"},resize_small:{classSuffix:"resize-small"}},controlGroup:["left","up","down","right","|","small","medium","large","resize_full","resize_small","remove"],init:function(){this.redactor.$editor.find("figure[data-type=quote]:not(:has(cite))").each(function(){t(this).append("<cite>")})},onShow:function(t,e){e.children().removeClass("on"),t.hasClass("wh-figure-medium")?e.find(".wh-figure-controls-medium").addClass("on"):t.hasClass("wh-figure-large")?e.find(".wh-figure-controls-large").addClass("on"):e.find(".wh-figure-controls-small").addClass("on"),t.hasClass("wh-figure-left")?(e.find(".wh-figure-controls-arrow-left").addClass("on"),e.find(".wh-figure-controls-resize-small").hide(),e.find(".wh-figure-controls-resize-full").show()):t.hasClass("wh-figure-right")?(e.find(".wh-figure-controls-arrow-right").addClass("on"),e.find(".wh-figure-controls-resize-small").hide(),e.find(".wh-figure-controls-resize-full").show()):(e.find(".wh-figure-controls-resize-small").show(),e.find(".wh-figure-controls-resize-full").hide())},command:function(t,e){switch(t){case"left":e.removeClass("wh-figure-right").addClass("wh-figure-left");break;case"right":e.removeClass("wh-figure-left").addClass("wh-figure-right");break;case"resize_full":e.removeClass("wh-figure-left wh-figure-right");break;case"resize_small":e.addClass("wh-figure-left");break;case"small":e.removeClass("wh-figure-medium wh-figure-large").addClass("wh-figure-small");break;case"medium":e.removeClass("wh-figure-small wh-figure-large").addClass("wh-figure-medium");break;case"large":e.removeClass("wh-figure-small wh-figure-medium").addClass("wh-figure-large")}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.quote={init:function(){this.quote=new e(this),this.buttonAddBefore("link","quote","Quote",t.proxy(function(){this.bufferSet(),this.formatQuote();var e=t(this.getBlock()||this.getCurrent());e.is("blockquote")?t('<figure data-type="quote">').insertBefore(e).prepend(e).append("<cite>Type to add quote credit (optional)</cite>"):e.closest("figure").before(e).remove(),this.sync()},this))}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t};e.prototype={control:{row_up:{text:"Add row above"},row_down:{text:"Add row below"},col_left:{text:"Add column left"},col_right:{text:"Add column right"},add_head:{text:"Add header"},del_head:{text:"Delete header"},del_col:{text:"Delete column"},del_row:{text:"Delete row"},del_table:{text:"Delete table"},stripe:{text:"Striped row"},border:{text:"Borders on rows"},full_border:{text:"Borders everywhere"}},controlGroup:["up","down","|",{"Table Options":["row_up","row_down","col_left","col_right","|","add_head","del_head","|","del_col","del_row","del_table","|","border","stripe","full_border"]},"remove"],insertTable:function(e,o){var i,r,s,a,n=t("<div></div>"),l=Math.floor(99999*Math.random()),d=t('<table id="table'+l+'">').addClass("wh-table wh-table-bordered-rows full-width"),c=t("<thead>").appendTo(d),h=t("<tbody>").appendTo(d);for(r=t("<tr>").appendTo(c),s=0;o>s;s++)t("<th>Header</th>").appendTo(r);for(i=0;e>i;i++){for(r=t("<tr>"),s=0;o>s;s++)a=t("<td>Data</td>"),0===i&&0===s&&a.append('<span id="selection-marker-1">'+this.redactor.opts.invisibleSpace+"</span>"),t(r).append(a);h.append(r)}t('<figure data-type="table">').append(d).appendTo(n);var u=n.html();this.redactor.modalClose(),this.redactor.selectionRestore(),this.redactor.bufferSet(this.redactor.$editor.html());var f=this.redactor.getBlock()||this.redactor.getCurrent();f?t(f).after(u):this.redactor.insertHtmlAdvanced(u,!1),this.redactor.selectionRestore();var p=this.redactor.$editor.find("#table"+l);p.find("span#selection-marker-1").remove(),p.removeAttr("id"),this.redactor.sync()},command:function(e,o,i){switch(e){case"row_up":case"row_down":t.proxy(function(){var o,r=i.closest("tr"),s=t("<tr>");for(o=0;r.children().length>o;o++)t("<td>").text("Data").appendTo(s);"row_up"===e?s.insertBefore(r):s.insertAfter(r)},this)();break;case"col_left":case"col_right":t.proxy(function(){var o=i.closest("td"),r=o.closest("tr"),s=r.closest("table"),a=r.children().index(o)+1,n="col_left"===e?"before":"after";s.find("thead tr").children(":nth-child("+a+")")[n](t("<th>").text("Header")),s.find("tbody tr").children(":nth-child("+a+")")[n](t("<td>").text("Data"))},this)();break;case"add_head":o.find("table thead").length||t.proxy(function(){for(var e=o.find("tr").first().children().length,i=o.find("table"),r=t("<thead>").prependTo(i),s=t("<tr>").appendTo(r),a=0;e>a;a++)t("<th>").text("Header").appendTo(s)},this)();break;case"del_head":o.find("thead").remove();break;case"del_col":t.proxy(function(){var t=i.closest("td"),e=t.parent().children().index(t)+1;t.closest("table").find("tr").children(":nth-child("+e+")").remove()},this)();break;case"del_row":i.closest("tr").remove();break;case"del_table":o.remove();break;case"border":o.find("table").removeClass("wh-table-bordered-all").toggleClass("wh-table-bordered-rows");break;case"stripe":o.find("table").toggleClass("wh-table-striped");break;case"full_border":o.find("table").removeClass("wh-table-bordered-rows").toggleClass("wh-table-bordered-all")}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.table={init:function(){this.table=new e(this),this.buttonAddBefore("link","table","Table",t.proxy(function(){this.selectionSave();var e=t.proxy(function(){t("#redactor_insert_table_btn").on("click",t.proxy(function(){this.table.insertTable(t("#redactor_table_rows").val(),t("#redactor_table_columns").val())},this)),setTimeout(function(){t("#redactor_table_rows").trigger("focus")},200)},this),o="<section><label>"+this.opts.curLang.rows+"</label>"+'<input type="text" size="5" value="2" id="redactor_table_rows">'+"<label>"+this.opts.curLang.columns+"</label>"+'<input type="text" size="5" value="3" id="redactor_table_columns">'+"</section>"+"<footer>"+'<button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+this.opts.curLang.insert+'">'+"</footer>";this.modalInit("Insert Table",o,500,e)},this))}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t,this.init()};e.prototype={control:{resize_full:{classSuffix:"resize-full"},resize_small:{classSuffix:"resize-small"}},controlGroup:["up","down","|","resize_full","resize_small","remove"],init:function(){this.redactor.$editor.find("figure[data-type=video]:not(:has(figcaption))").each(function(){t(this).append("<figcaption>")})},onShow:function(t,e){t.hasClass("wh-figure-full")?(e.find(".wh-figure-controls-resize-full").hide(),e.find(".wh-figure-controls-resize-small").show()):(e.find(".wh-figure-controls-resize-full").show(),e.find(".wh-figure-controls-resize-small").hide())},command:function(t,e){"resize_full"===t?e.addClass("wh-figure-full"):"resize_small"===t&&e.removeClass("wh-figure-full")}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.video={init:function(){this.video=new e(this);var o=function(e){this.bufferSet(),e='<figure data-type="video"><p>'+this.cleanStripTags(e)+"</p><figcaption>Type to add caption (optional)</figcaption></figure>",this.selectionRestore();var o=this.getBlock()||this.getCurrent();o?t(o).after(e):this.insertHtmlAdvanced(e,!1),this.sync(),this.modalClose()},i=/(http|https):\/\/[\w\-]+(\.[\w\-]+)+([\w.,@?\^=%&amp;:\/~+#\-]*[\w@?\^=%&amp;\/~+#\-])?/;this.buttonAddBefore("link","video","Video",t.proxy(function(){var e=t.proxy(function(){this.selectionSave(),t("#redactor_insert_video_btn").click(t.proxy(function(){var e=t.trim(t("#redactor_insert_video_area").val());i.test(e)?t.embedly.oembed(e).done(t.proxy(function(e){t.each(e,t.proxy(function(t,e){o.call(this,e.html)},this))},this)):o.call(this,e)},this)),setTimeout(function(){t("#redactor_insert_video_area").focus()},200)},this),r='<section><form id="redactorInsertVideoForm"><label>'+this.opts.curLang.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+"</section>"+"<footer>"+'<button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>";this.modalInit("Insert Video",r,500,e)},this))}}}(jQuery),function(t){t.fn.webhookRedactor=function(e){return this.redactor("string"==typeof e?e:t.extend({},t.webhookRedactor.options,e))},t.webhookRedactor=function(e){return t.extend({},t.webhookRedactor.options,e)},t.webhookRedactor.options={observeImages:!1,buttons:["formatting","|","bold","italic","|","unorderedlist","orderedlist","|","link","|","html"],plugins:["cleanup","fullscreen","fixedtoolbar","autoembedly","figure","image","video","table","quote"],initCallback:function(){this.$element.closest("form").one("submit",t.proxy(this.sync,this))}}}(jQuery);