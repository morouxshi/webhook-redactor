/*! webhook-redactor - v0.0.1 - 2013-09-06
* https://github.com/gpbmike/webhook-redactor
* Copyright (c) 2013 Mike Horn; Licensed MIT */
(function(e){"use strict";window.RedactorPlugins=window.RedactorPlugins||{},e.embedly.defaults.key="65874c90af644c6a8f0b7072fe857811",e.embedly.defaults.query={maxwidth:640};var t=function(e){this.redactor=e,this.observe()};t.prototype={observe:function(){this.redactor.$editor.on("keyup.redactor",e.proxy(function(e){e.which===this.redactor.keyCode.ENTER&&this.checkNode(this.redactor.$editor.get(0))},this))},checkNode:function(t){return e.each(t.childNodes,e.proxy(function(t,o){if(3===o.nodeType&&o.nodeValue&&o.nodeValue.match(/((http:\/\/(.*youtube\.com\/watch.*|.*\.youtube\.com\/v\/.*|youtu\.be\/.*|.*\.youtube\.com\/user\/.*|.*\.youtube\.com\/.*#.*\/.*|m\.youtube\.com\/watch.*|m\.youtube\.com\/index.*|.*\.youtube\.com\/profile.*|.*\.youtube\.com\/view_play_list.*|.*\.youtube\.com\/playlist.*|www\.vimeo\.com\/groups\/.*\/videos\/.*|www\.vimeo\.com\/.*|vimeo\.com\/groups\/.*\/videos\/.*|vimeo\.com\/.*|vimeo\.com\/m\/#\/.*|player\.vimeo\.com\/.*))|(https:\/\/(.*youtube\.com\/watch.*|.*\.youtube\.com\/v\/.*|www\.vimeo\.com\/.*|vimeo\.com\/.*|player\.vimeo\.com\/.*)))/i)){var i=o.nodeValue,s=e("<span>loading...</span>");e(o).replaceWith(s),e.embedly.oembed(i).done(function(t){e.each(t,function(){s.replaceWith('<figure data-type="video"><p>'+this.html+"</p><figcaption>Type to add caption (optional)</figcaption></figure>")})})}else 1!==o.nodeType||/^(a|button|textarea)$/i.test(o.tagName)||this.checkNode(o)},this)),this.matches}},window.RedactorPlugins.autoembedly={init:function(){this.autoembedly=new t(this)}}})(jQuery),function(e){"use strict";var t=function(e){this.redactor=e,this.init()};t.prototype={init:function(){this.removeEmptyPs()},removeEmptyPs:function(){this.redactor.$editor.find("p").each(function(){var t=e(this);t.html().replace(/\s|&nbsp;/g,"").length||t.remove()})}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.cleanup={init:function(){this.cleanup=new t(this)}}}(jQuery),function(e){"use strict";var t=function(e){this.redactor=e,this.toolbar={},this.observe()};t.prototype={control:{up:{classSuffix:"arrow-up"},down:{classSuffix:"arrow-down"},"|":{classSuffix:"divider"},remove:{classSuffix:"delete"}},controlGroup:["up","down","remove"],observe:function(){this.redactor.$editor.on("mouseenter","figure",e.proxy(function(t){var o=e(t.currentTarget),i=o.data("type"),s=this.getToolbar(i).data("figure",o).prependTo(o);this.redactor[i]&&this.redactor[i].onShow&&this.redactor[i].onShow(o,s)},this)),this.redactor.$editor.on("mouseleave","figure",e.proxy(function(t){e(t.currentTarget).find(".wh-figure-controls").appendTo(this.redactor.$box)},this)),this.redactor.$editor.on("mousedown",".wh-figure-controls",e.proxy(function(){this.current=this.redactor.getCurrent()},this)),this.redactor.$editor.on("click",".wh-figure-controls span, .wh-figure-controls a",e.proxy(function(t){t.stopPropagation();var o=e(t.currentTarget),i=o.data("command"),s=o.closest("figure"),r=this.redactor[s.data("type")];this.command(i,s,r)},this))},getToolbar:function(t){if(this.toolbar[t])return this.toolbar[t];var o=this.redactor[t]&&this.redactor[t].controlGroup||this.controlGroup,i=e.extend({},this.control,this.redactor[t]&&this.redactor[t].control||{}),s=this.buildControls(o,i),r=e('<div class="wh-figure-controls">').append(s);return this.toolbar[t]=r},buildControls:function(t,o){var i=e();return e.each(t,e.proxy(function(t,s){var r;"string"==typeof s?(r=o[s],i=i.add(e("<span>",{"class":"wh-figure-controls-"+r.classSuffix,text:r.text}).data({command:s,control:r}))):"object"==typeof s&&e.each(s,e.proxy(function(t,s){var a=e("<span>",{"class":"wh-figure-controls-table wh-dropdown",text:" "+t});e('<span class="caret">').appendTo(a);var n=e('<dl class="wh-dropdown-menu wh-dropdown-bubble wh-dropdown-arrow wh-dropdown-arrow-left">').appendTo(a);e.each(s,e.proxy(function(t,i){r=o[i],"|"===i?e('<dd class="divider">').appendTo(n):e("<a>",{text:r.text}).data({command:i,control:r}).appendTo(e("<dd>").appendTo(n))},this)),i=i.add(a)},this))},this)),i},command:function(t,o,i){switch(o.find(".wh-figure-controls").appendTo(this.redactor.$box),this.redactor.bufferSet(),t){case"up":o.insertBefore(o.prev());break;case"down":o.insertAfter(o.next());break;case"remove":o.remove();break;default:i&&i.command&&i.command(t,o,e(this.current))}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.figure={init:function(){this.figure=new t(this)}}}(jQuery),function(e){"use strict";var t=function(t){this.redactor=t,this.$window=e(t.window),this.$window.on("scroll",e.proxy(this.checkOffset,this))};t.prototype={checkOffset:function(){0>=this.redactor.$box.offset().top-this.$window.scrollTop()?this.fix():this.unfix()},fix:function(){var e=parseInt(this.redactor.$box.css("border-left-width").replace("px",""),10);this.redactor.$toolbar.css({position:"fixed",left:this.redactor.$box.offset().left+e,width:this.redactor.$box.width(),zIndex:1}),this.redactor.$editor.css("padding-top",this.redactor.$toolbar.height()+10)},unfix:function(){this.redactor.$toolbar.css({position:"relative",left:"auto",width:"auto"}),this.redactor.$editor.css("padding-top",10)}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.fixedtoolbar={init:function(){this.fixedtoolbar=new t(this)}}}(jQuery),function(e){"use strict";window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.fullscreen={init:function(){this.fullscreen=!1,this.buttonAdd("fullscreen","Fullscreen",e.proxy(this.toggleFullscreen,this)),this.buttonSetRight("fullscreen"),this.opts.fullscreen&&this.toggleFullscreen()},toggleFullscreen:function(){var t;if(this.fullscreen){this.buttonRemoveIcon("fullscreen","normalscreen"),this.buttonInactive("fullscreen"),this.fullscreen=!1,e(window).off("resize",e.proxy(this.fullScreenResize,this)),e("body, html").css("overflow",""),this.$box.removeClass("redactor_box_fullscreen").css({width:"auto",height:"auto"}),this.opts.iframe&&(t=this.$editor.html()),this.tmpspan.after(this.$box).remove(),this.opts.iframe?this.fullscreenIframe(t):this.sync();var o=this.fsheight;this.opts.autoresize&&(o="auto"),this.opts.toolbarExternal&&(this.$box.css("top",this.boxcss.top),this.$toolbar.css({width:this.toolcss.width,top:this.toolcss.top,position:this.toolcss.position})),this.opts.iframe?this.$frame.css("height",o):this.$editor.css("height",o),this.$editor.css("height",o),this.focus(),this.observeStart()}else this.buttonChangeIcon("fullscreen","normalscreen"),this.buttonActive("fullscreen"),this.fullscreen=!0,this.opts.toolbarExternal&&(this.toolcss={},this.boxcss={},this.toolcss.width=this.$toolbar.css("width"),this.toolcss.top=this.$toolbar.css("top"),this.toolcss.position=this.$toolbar.css("position"),this.boxcss.top=this.$box.css("top")),this.fsheight=this.$editor.height(),this.opts.iframe&&(t=this.get()),this.tmpspan=e("<span></span>"),this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan),e("body, html").css("overflow","hidden"),e("body").prepend(this.$box),this.opts.iframe&&this.fullscreenIframe(t),this.fullScreenResize(),e(window).resize(e.proxy(this.fullScreenResize,this)),e(document).scrollTop(0,0),this.focus(),this.observeStart()},fullscreenIframe:function(e){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(e):this.set(e),this.opts.wym&&this.$editor.addClass("redactor_editor_wym")},fullScreenResize:function(){if(!this.fullscreen)return!1;var t=this.$toolbar.height(),o=this.$editor.css("padding-top").replace("px",""),i=e(window).height()-t;this.$box.width(e(window).width()-2).height(i+t),this.opts.toolbarExternal&&(this.$toolbar.css({top:"0px",position:"absolute",width:"100%"}),this.$box.css("top",t+"px")),this.opts.iframe?setTimeout(e.proxy(function(){this.$frame.height(i)},this),1):this.$editor.height(i-2*o),this.$editor.height(i)}}}(jQuery),function(e){"use strict";var t=function(e){this.redactor=e};t.prototype={control:{left:{classSuffix:"arrow-left"},right:{classSuffix:"arrow-right"},small:{classSuffix:"small",text:"S"},medium:{classSuffix:"medium",text:"M"},resize_full:{classSuffix:"resize-full"},resize_small:{classSuffix:"resize-small"}},controlGroup:["left","up","down","right","|","small","medium","resize_full","resize_small","remove"],onShow:function(e,t){t.children().removeClass("on"),e.hasClass("wh-figure-small")?(t.find(".wh-figure-controls-small").show().addClass("on"),t.find(".wh-figure-controls-medium").show(),t.find(".wh-figure-controls-resize-full").show(),t.find(".wh-figure-controls-resize-small").hide()):e.hasClass("wh-figure-medium")?(t.find(".wh-figure-controls-small").show(),t.find(".wh-figure-controls-medium").show().addClass("on"),t.find(".wh-figure-controls-resize-full").show(),t.find(".wh-figure-controls-resize-small").hide()):(t.find(".wh-figure-controls-small").hide(),t.find(".wh-figure-controls-medium").hide(),t.find(".wh-figure-controls-large").hide(),t.find(".wh-figure-controls-resize-full").hide(),t.find(".wh-figure-controls-resize-small").show()),e.hasClass("wh-figure-right")&&t.find(".wh-figure-controls-arrow-right").addClass("on"),e.hasClass("wh-figure-left")&&t.find(".wh-figure-controls-arrow-left").addClass("on")},command:function(t,o){var i=function(t,o,i,s){e.isArray(t)||(t=[t]);var r=(s?".":"")+"wh-figure-"+(i||"");return r+t.join((o||" ")+r)},s=function(e,t){o.removeClass(i(e)).addClass(i(t))};switch(t){case"left":case"right":s(["left","right"],t),o.hasClass("wh-figure-medium")||o.hasClass("wh-figure-small")||o.addClass("wh-figure-medium");break;case"small":case"medium":s(["small","medium","large"],t),o.hasClass("wh-figure-left")||o.hasClass("wh-figure-right")||o.addClass("wh-figure-left");break;case"resize_full":s(["small","medium","left","right"],"large");break;case"resize_small":s(["small","large","right"],["medium","left"])}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.image={init:function(){this.image=new t(this)}}}(jQuery),function(e){"use strict";var t=function(e){this.redactor=e};t.prototype={control:{left:{classSuffix:"arrow-left"},right:{classSuffix:"arrow-right"},small:{classSuffix:"small",text:"S"},medium:{classSuffix:"medium",text:"M"},large:{classSuffix:"large",text:"L"},resize_full:{classSuffix:"resize-full"},resize_small:{classSuffix:"resize-small"}},controlGroup:["left","up","down","right","|","small","medium","large","resize_full","resize_small","remove"],onShow:function(e,t){t.children().removeClass("on"),e.hasClass("wh-figure-medium")?t.find(".wh-figure-controls-medium").addClass("on"):e.hasClass("wh-figure-large")?t.find(".wh-figure-controls-large").addClass("on"):t.find(".wh-figure-controls-small").addClass("on"),e.hasClass("wh-figure-left")?(t.find(".wh-figure-controls-arrow-left").addClass("on"),t.find(".wh-figure-controls-resize-small").hide(),t.find(".wh-figure-controls-resize-full").show()):e.hasClass("wh-figure-right")?(t.find(".wh-figure-controls-arrow-right").addClass("on"),t.find(".wh-figure-controls-resize-small").hide(),t.find(".wh-figure-controls-resize-full").show()):(t.find(".wh-figure-controls-resize-small").show(),t.find(".wh-figure-controls-resize-full").hide())},command:function(e,t){switch(e){case"left":t.removeClass("wh-figure-right").addClass("wh-figure-left");break;case"right":t.removeClass("wh-figure-left").addClass("wh-figure-right");break;case"resize_full":t.removeClass("wh-figure-left wh-figure-right");break;case"resize_small":t.addClass("wh-figure-left");break;case"small":t.removeClass("wh-figure-medium wh-figure-large").addClass("wh-figure-small");break;case"medium":t.removeClass("wh-figure-small wh-figure-large").addClass("wh-figure-medium");break;case"large":t.removeClass("wh-figure-small wh-figure-medium").addClass("wh-figure-large")}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.quote={init:function(){this.quote=new t(this),this.buttonAddBefore("link","quote","Quote",e.proxy(function(){this.bufferSet(),this.formatQuote();var t=e(this.getBlock()||this.getCurrent());t.is("blockquote")?e('<figure data-type="quote">').insertBefore(t).prepend(t).append("<cite>Type to add quote credit (optional)</cite>"):t.closest("figure").before(t).remove(),this.sync()},this))}}}(jQuery),function(e){"use strict";var t=function(e){this.redactor=e};t.prototype={control:{row_up:{text:"Add row above"},row_down:{text:"Add row below"},col_left:{text:"Add column left"},col_right:{text:"Add column right"},add_head:{text:"Add header"},del_head:{text:"Delete header"},del_col:{text:"Delete column"},del_row:{text:"Delete row"},del_table:{text:"Delete table"},stripe:{text:"Striped row"},border:{text:"Borders on rows"},full_border:{text:"Borders everywhere"}},controlGroup:["up","down","|",{"Table Options":["row_up","row_down","col_left","col_right","|","add_head","del_head","|","del_col","del_row","del_table","|","border","stripe","full_border"]},"remove"],command:function(t,o,i){switch(t){case"row_up":case"row_down":e.proxy(function(){var e=i.closest("tr"),o=e.clone().find("td").text("Data").end();"row_up"===t?o.insertBefore(e):o.insertAfter(e)},this)();break;case"col_left":case"col_right":e.proxy(function(){var o=i.closest("td"),s=o.closest("tr"),r=s.closest("table"),a=s.children().index(o)+1,n="col_left"===t?"before":"after";r.find("thead tr").children(":nth-child("+a+")")[n](e("<th>").text("Header")),r.find("tbody tr").children(":nth-child("+a+")")[n](e("<td>").text("Data"))},this)();break;case"add_head":e.proxy(function(){for(var t=o.find("tr").first().children().length,i=o.find("table"),s=e("<thead>").prependTo(i),r=e("<tr>").appendTo(s),a=0;t>a;a++)e("<th>").text("Header").appendTo(r)},this)();break;case"del_head":o.find("thead").remove();break;case"del_col":e.proxy(function(){var e=i.closest("td"),t=e.parent().children().index(e)+1;e.closest("table").find("tr").children(":nth-child("+t+")").remove()},this)();break;case"del_row":i.closest("tr").remove();break;case"del_table":o.remove();break;case"border":o.find("table").removeClass("wh-table-bordered-all").toggleClass("wh-table-bordered-rows");break;case"stripe":o.find("table").toggleClass("wh-table-striped");break;case"full_border":o.find("table").removeClass("wh-table-bordered-rows").toggleClass("wh-table-bordered-all")}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.table={init:function(){this.table=new t(this),this.buttonAddBefore("link","table","Table",e.proxy(function(){var t=e.proxy(function(){this.selectionSave(),e("#redactor_insert_table_btn").click(e.proxy(function(){this.bufferSet();var t,o,i,s,r=e("#redactor_table_rows").val(),a=e("#redactor_table_columns").val(),n=e("<div></div>"),l=Math.floor(99999*Math.random()),d=e('<table id="table'+l+'">').addClass("wh-table wh-table-bordered-rows full-width"),c=e("<thead>").appendTo(d),h=e("<tbody>").appendTo(d);for(o=e("<tr>").appendTo(c),i=0;a>i;i++)e("<th>Header</th>").appendTo(o);for(t=0;r>t;t++){for(o=e("<tr>"),i=0;a>i;i++)s=e("<td>Data</td>"),0===t&&0===i&&s.append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),e(o).append(s);h.append(o)}e('<figure data-type="table">').append(d).appendTo(n);var u=n.html();this.modalClose(),this.selectionRestore();var f=this.getBlock()||this.getCurrent();f?e(f).after(u):this.insertHtmlAdvanced(u,!1),this.selectionRestore();var w=this.$editor.find("#table"+l);this.tableObserver(w),this.buttonActiveObserver(),w.find("span#selection-marker-1").remove(),w.removeAttr("id"),this.sync()},this)),setTimeout(function(){e("#redactor_table_rows").focus()},200)},this),o="<section><label>"+this.opts.curLang.rows+"</label>"+'<input type="text" size="5" value="2" id="redactor_table_rows">'+"<label>"+this.opts.curLang.columns+"</label>"+'<input type="text" size="5" value="3" id="redactor_table_columns">'+"</section>"+"<footer>"+'<button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+this.opts.curLang.insert+'">'+"</footer>";this.modalInit("Insert Table",o,500,t)},this))}}}(jQuery),function(e){"use strict";var t=function(e){this.redactor=e};t.prototype={control:{resize_full:{classSuffix:"resize-full"},resize_small:{classSuffix:"resize-small"}},controlGroup:["up","down","|","resize_full","resize_small","remove"],onShow:function(e,t){e.hasClass("wh-figure-full")?(t.find(".wh-figure-controls-resize-full").hide(),t.find(".wh-figure-controls-resize-small").show()):(t.find(".wh-figure-controls-resize-full").show(),t.find(".wh-figure-controls-resize-small").hide())},command:function(e,t){"resize_full"===e?t.addClass("wh-figure-full"):"resize_small"===e&&t.removeClass("wh-figure-full")}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.video={init:function(){this.video=new t(this);var o=function(t){this.bufferSet(),t='<figure data-type="video"><p>'+this.cleanStripTags(t)+"</p><figcaption>Type to add caption (optional)</figcaption></figure>",this.selectionRestore();var o=this.getBlock()||this.getCurrent();o?e(o).after(t):this.insertHtmlAdvanced(t,!1),this.sync(),this.modalClose()},i=/(http|https):\/\/[\w\-]+(\.[\w\-]+)+([\w.,@?\^=%&amp;:\/~+#\-]*[\w@?\^=%&amp;\/~+#\-])?/;this.buttonAddBefore("link","video","Video",e.proxy(function(){var t=e.proxy(function(){this.selectionSave(),e("#redactor_insert_video_btn").click(e.proxy(function(){var t=e.trim(e("#redactor_insert_video_area").val());i.test(t)?e.embedly.oembed(t).done(e.proxy(function(t){e.each(t,e.proxy(function(e,t){o.call(this,t.html)},this))},this)):o.call(this,t)},this)),setTimeout(function(){e("#redactor_insert_video_area").focus()},200)},this),s='<section><form id="redactorInsertVideoForm"><label>'+this.opts.curLang.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+"</section>"+"<footer>"+'<button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>";this.modalInit("Insert Video",s,500,t)},this))}}}(jQuery),function(e){e.fn.webhookRedactor=function(t){return this.redactor(e.extend({},e.webhookRedactor.options,t))},e.webhookRedactor=function(t){return t=e.extend({},e.awesome.options,t)},e.webhookRedactor.options={observeImages:!1,buttons:["formatting","|","bold","italic","|","unorderedlist","orderedlist","|","link","|","html"],plugins:["cleanup","fullscreen","fixedtoolbar","autoembedly","figure","image","video","table","quote"]}}(jQuery);