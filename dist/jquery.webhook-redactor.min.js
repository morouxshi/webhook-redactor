/*! webhook-redactor - v0.0.1 - 2013-09-05
* https://github.com/gpbmike/webhook-redactor
* Copyright (c) 2013 Mike Horn; Licensed MIT */
(function(t){"use strict";window.RedactorPlugins=window.RedactorPlugins||{},t.embedly.defaults.key="65874c90af644c6a8f0b7072fe857811",t.embedly.defaults.query={maxwidth:640};var e=function(t){this.redactor=t,this.observe()};e.prototype={observe:function(){this.redactor.$editor.on("keyup.redactor",t.proxy(function(t){t.which===this.redactor.keyCode.ENTER&&this.checkNode(this.redactor.$editor.get(0))},this))},checkNode:function(e){return t.each(e.childNodes,t.proxy(function(e,o){if(3===o.nodeType&&o.nodeValue&&o.nodeValue.match(/((http:\/\/(.*youtube\.com\/watch.*|.*\.youtube\.com\/v\/.*|youtu\.be\/.*|.*\.youtube\.com\/user\/.*|.*\.youtube\.com\/.*#.*\/.*|m\.youtube\.com\/watch.*|m\.youtube\.com\/index.*|.*\.youtube\.com\/profile.*|.*\.youtube\.com\/view_play_list.*|.*\.youtube\.com\/playlist.*|www\.vimeo\.com\/groups\/.*\/videos\/.*|www\.vimeo\.com\/.*|vimeo\.com\/groups\/.*\/videos\/.*|vimeo\.com\/.*|vimeo\.com\/m\/#\/.*|player\.vimeo\.com\/.*))|(https:\/\/(.*youtube\.com\/watch.*|.*\.youtube\.com\/v\/.*|www\.vimeo\.com\/.*|vimeo\.com\/.*|player\.vimeo\.com\/.*)))/i)){var i=o.nodeValue,r=t("<span>loading...</span>");t(o).replaceWith(r),t.embedly.oembed(i).done(function(e){t.each(e,function(){r.replaceWith(this.html)})})}else 1!==o.nodeType||/^(a|button|textarea)$/i.test(o.tagName)||this.checkNode(o)},this)),this.matches}},window.RedactorPlugins.autoembedly={init:function(){this.autoembedly=new e(this)}}})(jQuery),function(t){"use strict";var e=function(t){this.redactor=t,this.init()};e.prototype={init:function(){this.removeEmptyPs()},removeEmptyPs:function(){this.redactor.$editor.find("p").each(function(){var e=t(this);e.html().replace(/\s|&nbsp;/g,"").length||e.remove()})}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.cleanup={init:function(){this.cleanup=new e(this)}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t,this.toolbar={},this.observe()};e.prototype={control:{up:{classSuffix:"arrow-up"},down:{classSuffix:"arrow-down"},"|":{classSuffix:"divider"},remove:{classSuffix:"delete"}},controlGroup:["up","down","remove"],observe:function(){this.redactor.$editor.on("mouseenter","figure",t.proxy(function(e){var o=t(e.currentTarget),i=o.data("type"),r=this.getToolbar(i).data("figure",o).prependTo(o);r.trigger("show")},this)),this.redactor.$editor.on("mouseleave","figure",t.proxy(function(e){t(e.currentTarget).find(".wh-figure-controls").appendTo(this.redactor.$box)},this)),this.redactor.$editor.on("mousedown",".wh-figure-controls",t.proxy(function(){this.current=this.redactor.getCurrent()},this)),this.redactor.$editor.on("click",".wh-figure-controls span, .wh-figure-controls a",t.proxy(function(e){e.stopPropagation();var o=t(e.currentTarget),i=o.data("command"),r=o.closest("figure"),s=this.redactor[r.data("type")];this.command(i,r,s)},this))},getToolbar:function(e){if(this.toolbar[e])return this.toolbar[e];var o=this.redactor[e]&&this.redactor[e].controlGroup||this.controlGroup,i=t.extend({},this.control,this.redactor[e]&&this.redactor[e].control||{}),r=this.buildControls(o,i),s=t('<div class="wh-figure-controls">').append(r);return this.toolbar[e]=s},buildControls:function(e,o){var i=t();return t.each(e,t.proxy(function(e,r){var s;"string"==typeof r?(s=o[r],i=i.add(t("<span>",{"class":"wh-figure-controls-"+s.classSuffix,text:s.text}).data({command:r,control:s}))):"object"==typeof r&&t.each(r,t.proxy(function(e,r){var n=t("<span>",{"class":"wh-figure-controls-table wh-dropdown",text:" "+e});t('<span class="caret">').appendTo(n);var a=t('<dl class="wh-dropdown-menu wh-dropdown-bubble wh-dropdown-arrow wh-dropdown-arrow-left">').appendTo(n);t.each(r,t.proxy(function(e,i){s=o[i],"|"===i?t('<dd class="divider">').appendTo(a):t("<a>",{text:s.text}).data({command:i,control:s}).appendTo(t("<dd>").appendTo(a))},this)),i=i.add(n)},this))},this)),i},command:function(t,e,o){switch(e.find(".wh-figure-controls").appendTo(this.redactor.$box),this.redactor.bufferSet(),t){case"up":e.insertBefore(e.prev());break;case"down":e.insertAfter(e.next());break;case"remove":e.remove();break;default:o&&o.command&&o.command(t,e)}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.figure={init:function(){this.figure=new e(this)}}}(jQuery),function(t){"use strict";var e=function(e){this.redactor=e,this.$window=t(e.window),this.$window.on("scroll",t.proxy(this.checkOffset,this))};e.prototype={checkOffset:function(){0>=this.redactor.$box.offset().top-this.$window.scrollTop()?this.fix():this.unfix()},fix:function(){var t=parseInt(this.redactor.$box.css("border-left-width").replace("px",""),10);this.redactor.$toolbar.css({position:"fixed",left:this.redactor.$box.offset().left+t,width:this.redactor.$box.width(),zIndex:1}),this.redactor.$editor.css("padding-top",this.redactor.$toolbar.height()+10)},unfix:function(){this.redactor.$toolbar.css({position:"relative",left:"auto",width:"auto"}),this.redactor.$editor.css("padding-top",10)}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.fixedtoolbar={init:function(){this.fixedtoolbar=new e(this)}}}(jQuery),function(t){"use strict";window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.fullscreen={init:function(){this.fullscreen=!1,this.buttonAdd("fullscreen","Fullscreen",t.proxy(this.toggleFullscreen,this)),this.buttonSetRight("fullscreen"),this.opts.fullscreen&&this.toggleFullscreen()},toggleFullscreen:function(){var e;if(this.fullscreen){this.buttonRemoveIcon("fullscreen","normalscreen"),this.buttonInactive("fullscreen"),this.fullscreen=!1,t(window).off("resize",t.proxy(this.fullScreenResize,this)),t("body, html").css("overflow",""),this.$box.removeClass("redactor_box_fullscreen").css({width:"auto",height:"auto"}),this.opts.iframe&&(e=this.$editor.html()),this.tmpspan.after(this.$box).remove(),this.opts.iframe?this.fullscreenIframe(e):this.sync();var o=this.fsheight;this.opts.autoresize&&(o="auto"),this.opts.toolbarExternal&&(this.$box.css("top",this.boxcss.top),this.$toolbar.css({width:this.toolcss.width,top:this.toolcss.top,position:this.toolcss.position})),this.opts.iframe?this.$frame.css("height",o):this.$editor.css("height",o),this.$editor.css("height",o),this.focus(),this.observeStart()}else this.buttonChangeIcon("fullscreen","normalscreen"),this.buttonActive("fullscreen"),this.fullscreen=!0,this.opts.toolbarExternal&&(this.toolcss={},this.boxcss={},this.toolcss.width=this.$toolbar.css("width"),this.toolcss.top=this.$toolbar.css("top"),this.toolcss.position=this.$toolbar.css("position"),this.boxcss.top=this.$box.css("top")),this.fsheight=this.$editor.height(),this.opts.iframe&&(e=this.get()),this.tmpspan=t("<span></span>"),this.$box.addClass("redactor_box_fullscreen").after(this.tmpspan),t("body, html").css("overflow","hidden"),t("body").prepend(this.$box),this.opts.iframe&&this.fullscreenIframe(e),this.fullScreenResize(),t(window).resize(t.proxy(this.fullScreenResize,this)),t(document).scrollTop(0,0),this.focus(),this.observeStart()},fullscreenIframe:function(t){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(t):this.set(t),this.opts.wym&&this.$editor.addClass("redactor_editor_wym")},fullScreenResize:function(){if(!this.fullscreen)return!1;var e=this.$toolbar.height(),o=this.$editor.css("padding-top").replace("px",""),i=t(window).height()-e;this.$box.width(t(window).width()-2).height(i+e),this.opts.toolbarExternal&&(this.$toolbar.css({top:"0px",position:"absolute",width:"100%"}),this.$box.css("top",e+"px")),this.opts.iframe?setTimeout(t.proxy(function(){this.$frame.height(i)},this),1):this.$editor.height(i-2*o),this.$editor.height(i)}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t};e.prototype={control:{left:{classSuffix:"arrow-left"},right:{classSuffix:"arrow-right"},small:{classSuffix:"small",text:"S"},medium:{classSuffix:"medium",text:"M"},large:{classSuffix:"large",text:"L"}},controlGroup:["left","up","down","right","|","small","medium","large","remove"],command:function(t,e){var o=function(t,e,o,i){var r=(i?".":"")+"wh-figure-"+(o||"");return r+t.join((e||" ")+r)},i=function(t,i){e.removeClass(o(t)).addClass("wh-figure-"+i)};switch(t){case"left":case"right":"left"===t&&e.hasClass("wh-figure-right")?(e.removeClass("wh-figure-right"),i(["small","medium","large"],"large")):"right"===t&&e.hasClass("wh-figure-left")?(e.removeClass("wh-figure-left"),i(["small","medium","large"],"large")):(i(["left","right"],t),e.hasClass("wh-figure-medium")||e.hasClass("wh-figure-small")||e.addClass("wh-figure-medium"));break;case"small":case"medium":case"large":i(["small","medium","large"],t),"large"===t?e.removeClass(o(["left","right"])):e.hasClass("wh-figure-left")||e.hasClass("wh-figure-right")||e.addClass("wh-figure-left")}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.image={init:function(){this.image=new e(this),this.buttonAddBefore("link","image","Image",t.proxy(function(){window.console.log("image",this)},this.image))}}}(jQuery),function(t){"use strict";window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.quote={init:function(){this.buttonAddBefore("link","quote","Quote",t.proxy(function(){this.bufferSet(),this.formatQuote();var e=t(this.getBlock()||this.getCurrent());e.is("blockquote")?t('<figure data-type="quote"><figcaption>Type to add quote credit (optional)</figcaption>').insertBefore(e).prepend(e):e.closest("figure").before(e).remove(),this.sync()},this))}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t};e.prototype={control:{row_up:{text:"Add row above"},row_down:{text:"Add row below"},col_left:{text:"Add column left"},col_right:{text:"Add column right"},add_head:{text:"Add header"},del_head:{text:"Delete header"},del_col:{text:"Delete column"},del_row:{text:"Delete row"},del_table:{text:"Delete table"},border:{text:"Bordered"},stripe:{text:"Striped"},full_border:{text:"Full border"}},controlGroup:["up","down","|",{"Table Options":["row_up","row_down","col_left","col_right","|","add_head","del_head","|","del_col","del_row","del_table","|","border","stripe","full_border"]},"remove"],command:function(e,o){switch(e){case"row_up":case"row_down":t.proxy(function(){var o=t(this.current).closest("tr"),i=o.clone().find("td").text("Data").end();"row_up"===e?i.insertBefore(o):i.insertAfter(o)},this)();break;case"col_left":case"col_right":t.proxy(function(){var o=t(this.current).closest("td"),i=o.closest("tr"),r=i.closest("table"),s=i.children().index(o)+1,n="col_left"===e?"before":"after";r.find("thead tr").children(":nth-child("+s+")")[n](t("<th>").text("Header")),r.find("tbody tr").children(":nth-child("+s+")")[n](t("<td>").text("Data"))},this)();break;case"add_head":t.proxy(function(){for(var e=o.find("tr").first().children().length,i=o.find("table"),r=t("<thead>").prependTo(i),s=t("<tr>").appendTo(r),n=0;e>n;n++)t("<th>").text("Header").appendTo(s)},this)();break;case"del_head":o.find("thead").remove();break;case"del_col":t.proxy(function(){var e=t(this.current).closest("td"),o=e.parent().children().index(e)+1;e.closest("table").find("tr").children(":nth-child("+o+")").remove()},this)();break;case"del_row":t(this.current).closest("tr").remove();break;case"del_table":o.remove();break;case"border":o.find("table").removeClass("wh-table-bordered-all").toggleClass("wh-table-bordered-rows");break;case"stripe":o.find("table").toggleClass("wh-table-striped");break;case"full_border":o.find("table").removeClass("wh-table-bordered-rows").toggleClass("wh-table-bordered-all")}}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.table={init:function(){this.table=new e(this),this.buttonAddBefore("link","table","Table",t.proxy(function(){var e=t.proxy(function(){this.selectionSave(),t("#redactor_insert_table_btn").click(t.proxy(function(){this.bufferSet();var e,o,i,r,s=t("#redactor_table_rows").val(),n=t("#redactor_table_columns").val(),a=t("<div></div>"),d=Math.floor(99999*Math.random()),l=t('<table id="table'+d+'">').addClass("wh-table wh-table-bordered-rows full-width"),c=t("<thead>").appendTo(l),h=t("<tbody>").appendTo(l);for(o=t("<tr>").appendTo(c),i=0;n>i;i++)t("<th>Header</th>").appendTo(o);for(e=0;s>e;e++){for(o=t("<tr>"),i=0;n>i;i++)r=t("<td>Data</td>"),0===e&&0===i&&r.append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),t(o).append(r);h.append(o)}t('<figure data-type="table">').append(l).appendTo(a);var u=a.html();this.modalClose(),this.selectionRestore();var f=this.getBlock()||this.getCurrent();f?t(f).after(u):this.insertHtmlAdvanced(u,!1),this.selectionRestore();var p=this.$editor.find("#table"+d);this.tableObserver(p),this.buttonActiveObserver(),p.find("span#selection-marker-1").remove(),p.removeAttr("id"),this.sync()},this)),setTimeout(function(){t("#redactor_table_rows").focus()},200)},this),o="<section><label>"+this.opts.curLang.rows+"</label>"+'<input type="text" size="5" value="2" id="redactor_table_rows">'+"<label>"+this.opts.curLang.columns+"</label>"+'<input type="text" size="5" value="3" id="redactor_table_columns">'+"</section>"+"<footer>"+'<button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+this.opts.curLang.insert+'">'+"</footer>";this.modalInit("Insert Table",o,500,e)},this))}}}(jQuery),function(t){"use strict";var e=function(t){this.redactor=t};e.prototype={control:{resize:{classSuffix:"resize-full"}},controlGroup:["up","down","|","resize","remove"],command:function(t,e){"resize"===t&&e.toggleClass("wh-figure-full")}},window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.video={init:function(){this.video=new e(this);var o=function(e){this.bufferSet(),e='<figure data-type="video"><p>'+this.cleanStripTags(e)+"</p><figcaption>Type to add caption (optional)</figcaption></figure>",this.selectionRestore();var o=this.getBlock()||this.getCurrent();o?t(o).after(e):this.insertHtmlAdvanced(e,!1),this.sync(),this.modalClose()},i=/(http|https):\/\/[\w\-]+(\.[\w\-]+)+([\w.,@?\^=%&amp;:\/~+#\-]*[\w@?\^=%&amp;\/~+#\-])?/;this.buttonAddBefore("link","video","Video",t.proxy(function(){var e=t.proxy(function(){this.selectionSave(),t("#redactor_insert_video_btn").click(t.proxy(function(){var e=t.trim(t("#redactor_insert_video_area").val());i.test(e)?t.embedly.oembed(e).done(t.proxy(function(e){t.each(e,t.proxy(function(t,e){o.call(this,e.html)},this))},this)):o.call(this,e)},this)),setTimeout(function(){t("#redactor_insert_video_area").focus()},200)},this),r='<section><form id="redactorInsertVideoForm"><label>'+this.opts.curLang.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+"</section>"+"<footer>"+'<button class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</button>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>";this.modalInit("Insert Video",r,500,e)},this))}}}(jQuery),function(t){t.fn.webhookRedactor=function(e){return this.redactor(t.extend({},t.webhookRedactor.options,e))},t.webhookRedactor=function(e){return e=t.extend({},t.awesome.options,e)},t.webhookRedactor.options={observeImages:!1,buttons:["formatting","|","bold","italic","|","unorderedlist","orderedlist","|","link","|","html"],plugins:["cleanup","fullscreen","fixedtoolbar","autoembedly","figure","image","video","table","quote"]}}(jQuery);